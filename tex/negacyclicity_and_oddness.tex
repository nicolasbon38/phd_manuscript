%!TEX root = ../thesis.tex

\chapter{Overcoming the negacyclicity problem with odd plaintext modulus}
\label{chap:negacyclicity}

In Section \ref{sec:pbs}, we presented the algorithm of the PBS. But we hid something under the rug: the actual composition of the accumulator polynomial $\acc$. This is because its definition depends on the countermeasure picked against the negacyclicity problem (whom we had a glimpse on  in Section \ref{sec:overview_blind_rotation}. 


In this chapter, we formalize the negacyclicity problem. We then present the classical countermeasure (the strategy of the padding bit), and our technique of odd moduli, which is a building block for the rest of the works presented in this thesis. We finish by going through several others works that propose different countermeasures.




\paragraph{What is negacyclicity ?}


Let $v(X)$ be a polynomial of the ring $\glweRing$, denoted by $v(X) = \sum_{k=0}^{N-1} v_k X^k$. Recall how a multiplication by $X$  in this ring ``rotates'' the coefficients of the polynomial: \[X \cdot v(X) = - v_{N - 1} + v_0 \cdot X \dots + v_{N - 2} X^{N - 1}~.\]

In TFHE's blind rotation, the polynomial multiplication in the blind rotation is actually done by $X^{-\Tilde{\mu}}$, with $\Tilde{\mu} = \rounding{\frac{\mu \cdot 2N}{q}}$, which lives in $\{0, \dots, 2N - 1\}$. This leads to two problems:

\begin{itemize}
	\item A coefficient $v_j$ can be brought in first place by two differents rotations: the one induced by the polynomial multiplication by $X^{\modulo{-j}{2N}}$ and the one by $X^{[-j + N]_{2N}}$.
	\item Each time a coefficient goes last to first, it gets negated (because $X^N = -1$ in the ring). So actually, the multiplication by $X^{[-j]_{2N}}$ yields correctly $v_j$, but the one by $X^{[-j + N]_{2N}}$ yields $-v_j$.
\end{itemize}


As the actual value of $\tilde{\mu}$ is encrypted, this is not possible to predict beforehand whether this undesirable minus sign will appear or not. So, the accumulator polynomial has to be constructed in such a way that this problem is neutralized.


\paragraph{The ideal case}

Some functions interact naturally very well with the blind rotation algorithm: these are called the \textit{negacyclic functions} and they are presented in Definition \ref{def:negacyclic_function}.


\begin{definition} (Negacyclic Function)
	Let $p$ be an even integer, and $p'$ another one of arbitrary parity. A function $f : \Z_p \mapsto \Z_{p'}$ is negacyclic if and only if it satisfies the following property:
	
	\[
		\forall x \in \Z_p, f\left (\modulo{x + \frac p 2}{p} \right ) = \modulo{-f(x)}{p'}
	\]
	
	\label{def:negacyclic_function}
\end{definition}

With such functions, the accumulator is quite simple to build:

\begin{definition} (Negacyclic Accumulator)
	Let us consider an even plaintext modulus $p$. Let $f:\Z_p \mapsto \Z_{p'}$ be a negacyclic function. Then, the accumulator $\acc$, defined by:
	
	\[
		TODO
	\]
	
	is a valid accumulator for the blind rotation.
\end{definition}

The proof that it works is quite simple blah blah blah.



\paragraph{The classical countermeasure: the bit of padding}

- works in a even plaintext space
- expliquer comment ça marche
- donner la tête de l'accumulateur
- mais contraintes sur les circuits homomorphes que l'on peut évaluer



\paragraph{A new solution: the odd plaintext modulus}

- copy paste section 6.1 of BPR23



\paragraph{A tour of other solutions}

- Schild
- Le WoPBS (mais peut-être le présenter plus longuement dans le papier LUT)






